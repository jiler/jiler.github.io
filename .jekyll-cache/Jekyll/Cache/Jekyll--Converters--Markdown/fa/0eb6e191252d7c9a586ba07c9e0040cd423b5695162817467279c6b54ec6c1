I"¢J<h1 id="springç®€ä»‹">Springç®€ä»‹</h1>

<h2 id="spring-ioc">Spring IOC</h2>
<p>IOCå…¨ç§°Inversion of Controllï¼Œæ§åˆ¶åè½¬ã€‚å®¹å™¨è´Ÿè´£åˆ›å»ºBeanï¼Œå°†åŠŸèƒ½ç±»çš„beanæ³¨å…¥åˆ°éœ€è¦çš„Beanä¸­ã€‚ApplicationContextå°±æ˜¯ä¸€ä¸ªå®¹å™¨æ¥å£ï¼ŒAnnotationConfigApplicationContextå°±æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œå®ƒæ¥å—ä¸€ä¸ªé…ç½®ç±»ï¼ˆè¢«<code class="language-plaintext highlighter-rouge">@Configuration</code>æ³¨è§£çš„ç±»ï¼‰æ¥å®ä¾‹åŒ–ã€‚</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">Config</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">UserService</span> <span class="nc">UserService</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">UserService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Springæä¾›xmlã€æ³¨è§£ã€javaé…ç½®ã€groovyé…ç½®å®ç°Beançš„åˆ›å»ºå’Œæ³¨å…¥ã€‚
æ³¨è§£é…ç½®æŒ‡çš„æ˜¯ä¸šåŠ¡Beané…ç½®æ—¶ä½¿ç”¨çš„æ³¨è§£ï¼ˆ<code class="language-plaintext highlighter-rouge">@Service</code>ã€<code class="language-plaintext highlighter-rouge">@Controller</code>ã€<code class="language-plaintext highlighter-rouge">@Component</code>ï¼‰ï¼Œjavaé…ç½®é€‚ç”¨äºå…¨å±€é…ç½®ï¼ˆæ•°æ®åº“ç›¸å…³ï¼ŒMVCç›¸å…³é…ç½®ï¼Œä¸»è¦é€šè¿‡<code class="language-plaintext highlighter-rouge">@Configuration</code>å®ç°ï¼‰ã€‚</p>

<h2 id="spring-aop">Spring AOP</h2>
<p>AOPå…¨ç§°Aspect Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚Springæ”¯æŒAspectJæ³¨è§£å¼åˆ‡é¢ç¼–ç¨‹ï¼Œtodo wujunpeng ä½¿ç”¨ä¹¦ä¸­1.3.3çš„åˆ‡é¢å®ç°ä¸€ä¸‹éœ€æ±‚ã€‚
æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¼šç”¨æ³¨è§£å»ä¿®é¥°ä¸€ä¸ªcontrollerçš„è‹¥å¹²ä¸ªæ¥å£æ–¹æ³•ï¼Œç”¨æ¥åšé‰´æƒã€‚
ä¾‹å­ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-Java">import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
public @interface AuthAnnotation {

    /**
     * æ¥å£ç±»å‹
     * å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªvalueå‚æ•°ï¼Œä¸”æœ‰é»˜è®¤å€¼
     *
     * @return String
     */
    String value() default "select";
}
</code></pre>
<pre><code class="language-Java">import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;

@Aspect
@Component
public class AuthAspect {

    private static final Logger LOGGER = LoggerFactory.getLogger(AuthAspect.class);

    /**
     * ç”¨æˆ·æƒé™åˆ¤æ–­.
     *
     * @param pjp ProceedingJoinPoint
     * @param annotation æ³¨è§£
     * @return Object
     */
    @Around(value = "@annotation(annotation)")
    public Object process(ProceedingJoinPoint pjp, AuthAnnotation annotation) throws Throwable {
        validate(annotation.value());
        return pjp.proceed();
    }

    private void validate(String systemResourceCode) {
        String currentUser = "è·å–å½“å‰ç”¨æˆ·";
        LOGGER.info("å½“å‰ç™»å½•ç”¨æˆ·ï¼š{}", currentUser);
        boolean canAccess = checkAuth(currentUser, systemResourceCode);
        if (!canAccess) {
            LOGGER.info("å½“å‰ç™»å½•ç”¨æˆ·ï¼š{}ï¼Œæ— æƒé™", currentUser);
            throw new AuthException(ResponseState.ERROR_STATE.getCode(), "æ— æƒé™");
        }
    }
}
</code></pre>
<p>é™¤äº†å¯¹åº”çš„<code class="language-plaintext highlighter-rouge">@Around</code>æ³¨è§£ï¼Œè¿˜å¯ä»¥æœ‰<code class="language-plaintext highlighter-rouge">@Pointcut</code>ï¼Œ<code class="language-plaintext highlighter-rouge">@Before</code>ï¼Œ<code class="language-plaintext highlighter-rouge">@After</code>ç­‰ã€‚</p>

<p>å»ºç«‹åˆ‡å…¥ç‚¹ï¼Œæœ‰å¥½å‡ ç§æ–¹å¼ï¼Œå¸¸ç”¨çš„æœ‰<code class="language-plaintext highlighter-rouge">execution</code>å’Œ<code class="language-plaintext highlighter-rouge">annotation</code>ä¸¤ç§</p>
<pre><code class="language-Java">import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.aspectj.lang.reflect.MethodSignature;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

@Aspect
@Component
public class AuthAspect {

    private static final Logger LOGGER = LoggerFactory.getLogger(AuthAspect.class);

    @Pointcut("execution(public * com.jiler..*getGoodsList(..))")
    public void selectPoint() {

    }

    @Pointcut("execution(public * com.jiler..*test(..))")
    public void testPoint() {

    }

    @Pointcut("@annotation(AuthAnnotation)")
    public void annotationPoint() {

    }

    @Before("testPoint()")
    public void before() {
        LOGGER.info("æœ‰äººæŸ¥è¯¢äº†");
    }

    @Around("selectPoint()")
    public void around(ProceedingJoinPoint joinPoint) throws Throwable {
        LOGGER.info("æœ‰äººæŸ¥è¯¢äº†1");
        joinPoint.proceed();
        LOGGER.info("æœ‰äººæŸ¥è¯¢äº†2");

    }

    @After("annotationPoint()")
    public void after(ProceedingJoinPoint joinPoint) {
        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();
        AuthAnnotation authAnnotation = methodSignature.getMethod().getAnnotation(AuthAnnotation.class);
        String systemType = authAnnotation.value();

        LOGGER.info("æœ‰äººæŸ¥è¯¢äº†3");
    }

}
</code></pre>

<h2 id="springä¸­è·å–httpè¯·æ±‚å’Œè¿”å›">Springä¸­è·å–httpè¯·æ±‚å’Œè¿”å›</h2>

<pre><code class="language-Java">import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
HttpServletRequest request = attributes.getRequest();
HttpServletResponse response = attributes.getResponse();
</code></pre>

<h2 id="spring-beançš„scope">Spring Beançš„Scope</h2>

<ol>
  <li>Singletonï¼šä¸€ä¸ªSpringå®¹å™¨åªæœ‰ä¸€ä¸ªBeanå®ä¾‹ï¼Œé»˜è®¤é…ç½®ï¼Œå…¨å®¹å™¨å…±äº«ä¸€ä¸ªå®ä¾‹ã€‚</li>
  <li>Prototypeï¼š<strong>æ¯æ¬¡è°ƒç”¨</strong> æ–°å»ºä¸€ä¸ªBeanå®ä¾‹ã€‚æ¯æ¬¡è°ƒç”¨çš„æ„æ€æ˜¯ï¼šä¸€ä¸ªè¢«<code class="language-plaintext highlighter-rouge">@Scope("prototype")</code>æ³¨è§£ä¿®é¥°çš„ç±»ï¼Œæ¯æ¬¡è¢«ç”¨<code class="language-plaintext highlighter-rouge">@Autowired</code>æ³¨å…¥åˆ°ä¸åŒç±»ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„Beanã€‚ä¸‹æœ‰ä¾‹å­</li>
  <li>Requestï¼šwebæœåŠ¡ä¸­ï¼Œæ¯ä¸ªhttp requestæ–°å»ºä¸€ä¸ªBeanã€‚</li>
  <li>Sessionï¼šwebæœåŠ¡ä¸­ï¼Œæ¯ä¸ªhttp sessionæ–°å»ºä¸€ä¸ªBeanã€‚</li>
  <li>GlobalSessionï¼šåªåœ¨ <strong>portalåº”ç”¨</strong> ä¸­æœ‰ç”¨ï¼Œç»™æ¯ä¸ªglobal http sessionæ–°å»ºä¸€ä¸ªBeanã€‚</li>
</ol>

<p>Scopeçš„ä½¿ç”¨æ–¹å¼ä¸¾ä¾‹</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="s">"prototype"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div>
<p>å¯¹äºPrototypçš„è§£é‡Šï¼šä¸‹é¢ä¸¤ä¸ªç±»ä¸­çš„ä¸¤ä¸ªuserServiceå±æ€§ï¼Œä»–ä»¬çš„hashCodeå€¼ä¸åŒï¼Œæ˜¯ä¸¤ä¸ªBeanï¼Œå› ä¸ºé™å®šäº†prototypeã€‚è€Œæ²¡æœ‰<code class="language-plaintext highlighter-rouge">@Scope("prototype")</code>æ³¨è§£ä¿®é¥°çš„ç±»ï¼Œåˆ™é»˜è®¤æ˜¯singletonï¼Œç”¨<code class="language-plaintext highlighter-rouge">@Autowired</code>æ³¨å…¥åˆ°ä¸åŒçš„ç±»ä¸­ï¼ŒhashCodeå€¼ç›¸åŒï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªBeanã€‚</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QueryService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InsertService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">@Autowired</code>æ˜¯Springæä¾›çš„æ³¨è§£ï¼Œ<code class="language-plaintext highlighter-rouge">@Resource</code>æ˜¯JSR-250æä¾›çš„æ³¨è§£ã€‚JSRæ˜¯Java Specification Requestsçš„ç¼©å†™ï¼Œæ„æ€æ˜¯Java è§„èŒƒææ¡ˆ
`</p>
  <h2 id="å…¶ä»–æ³¨è§£">å…¶ä»–æ³¨è§£</h2>
  <p><code class="language-plaintext highlighter-rouge">@PostConstruct</code>ï¼Œ åœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œåæ‰§è¡Œã€‚
<code class="language-plaintext highlighter-rouge">@PreDestroy</code>ï¼Œåœ¨Beané”€æ¯ä¹‹å‰æ‰§è¡Œã€‚</p>
</blockquote>

<h2 id="application-event">Application Event</h2>
<p>Beanä¹‹é—´ä¼ é€’æ¶ˆæ¯å¯ä»¥ç”¨äº‹ä»¶ï¼Œé€šè¿‡å®ç°ApplicationListeneræ¥å£çš„æ–¹å¼ï¼Œå®ç°ç›‘å¬äº‹ä»¶ã€‚é€šè¿‡ç»§æ‰¿ApplicationEventæ¥å®šä¹‰äº‹ä»¶ï¼Œé€šè¿‡ApplicationContextçš„publishEventæ–¹æ³•æ¥å‘é€äº‹ä»¶ã€‚</p>

<h2 id="å…¶ä»–åŠŸèƒ½ç‚¹">å…¶ä»–åŠŸèƒ½ç‚¹</h2>
<h3 id="spring-aware">Spring Aware</h3>
<p>Springç®¡ç†çš„Beanå¯¹Springå®¹å™¨çš„å­˜åœ¨æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¦‚æœBeanä¸­è¦ç”¨åˆ°Springå®¹å™¨æœ¬èº«çš„èµ„æºï¼Œå°±è¦å¯¹å…¶æœ‰æ„ŸçŸ¥ï¼ŒSpring Awareå°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„ã€‚</p>
<h3 id="springçš„å¤šçº¿ç¨‹">Springçš„å¤šçº¿ç¨‹</h3>
<p>Springçš„å¤šçº¿ç¨‹å¯ä»¥é€šè¿‡ä»»åŠ¡æ‰§è¡Œå™¨TaskExecutoræ¥å®ç°ï¼Œé…ç½®æ—¶ç”¨<code class="language-plaintext highlighter-rouge">@EnableAsync</code>å¼€å¯å¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒï¼ŒBeanä¸­ç”¨<code class="language-plaintext highlighter-rouge">@Async</code>æ¥å£°æ˜è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚todo wujuneng å¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ çº¿ç¨‹æ± çš„è®¾ç½®ï¼Œç ”ç©¶å¦‚ä½•è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚</p>
<h3 id="æ¡ä»¶æ³¨è§£conditional">æ¡ä»¶æ³¨è§£<code class="language-plaintext highlighter-rouge">@Conditional</code></h3>
<p>todo wujunpeng é™¤äº†æ¡ä»¶æ³¨è§£ï¼Œè¿˜å¯ä»¥å­¦ä¹ è‡ªå®šä¹‰æ³¨è§£çš„å®ç°ï¼Œç»„åˆæ³¨è§£çš„åŸç†ç­‰ã€‚åˆ©ç”¨ä¹¦ä¸­çš„3.6ï¼Œæ€»ç»“<code class="language-plaintext highlighter-rouge">@Enable*</code>ç›¸å…³æ³¨è§£çš„çš„åŸç†ï¼Œå°¤å…¶æ˜¯<code class="language-plaintext highlighter-rouge">@Import</code>æ³¨è§£æ¥å¯¼å…¥é…ç½®çš„ä¸‰ç§ç±»å‹ã€‚</p>

<h2 id="spring-mvc">Spring MVC</h2>
<p>ä¸¤ä¸ªæ¦‚å¿µ</p>
<ol>
  <li>MVCï¼šModelï¼ˆæ•°æ®æ¨¡å‹ï¼‰ã€Viewï¼ˆè§†å›¾ï¼‰ã€Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</li>
  <li>ä¸‰å±‚æ¶æ„ï¼šPresentation tierå±•ç¤ºå±‚ã€Application tieråº”ç”¨å±‚ã€Data tieræ•°æ®è®¿é—®å±‚
    <ul>
      <li>MVCå®é™…ä¸Šå¯¹åº”çš„åªæ˜¯ä¸‰å±‚æ¶æ„çš„å±•ç¤ºå±‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå±•ç¤ºå±‚çš„å®ç°ç”¨çš„æ˜¯MVCçš„æ€æƒ³ã€‚Modelæ˜¯ç”¨æ¥å’ŒViewä¹‹é—´åšæ•°æ®äº¤äº’ã€ä¼ å€¼çš„ï¼ŒControllerå°±æ˜¯MVCçš„<code class="language-plaintext highlighter-rouge">@Controller</code>æ³¨è§£çš„ç±»ã€‚ç›®å‰å‰åç«¯åˆ†ç¦»çš„çº¯åç«¯æ¥å£å¼€å‘ï¼Œæ˜¯æ²¡æœ‰viewçš„ã€‚Modelå°±æ˜¯æ¥å£æä¾›çš„jsonã€‚</li>
      <li>ä¸‰å±‚æ¶æ„æ˜¯æ•´ä¸ªåº”ç”¨çš„æ¶æ„ï¼Œæ˜¯ç”±Springæ¡†æ¶è´Ÿè´£ç®¡ç†çš„ã€‚é¡¹ç›®ç»“æ„ä¸­çš„Serviceå±‚å’ŒDAOå±‚å°±æ˜¯ä¸‰å±‚æ¶æ„ä¸­çš„åº”ç”¨å±‚å’Œæ•°æ®è®¿é—®å±‚ã€‚</li>
    </ul>
  </li>
</ol>

<h3 id="ä¸€äº›ä¹‹å‰ç”¨çš„ä¸å¤ªç†Ÿæ‚‰çš„controlleræ³¨è§£">ä¸€äº›ä¹‹å‰ç”¨çš„ä¸å¤ªç†Ÿæ‚‰çš„Controlleræ³¨è§£</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span> <span class="c1">// 1</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
    <span class="err">@</span><span class="nd">@ResponseBody</span> <span class="c1">// 2</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/query/{userId}"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"application/xml;charset=UTF-8"</span><span class="o">)</span> <span class="c1">// 3</span>
    <span class="kd">public</span> <span class="nc">UserVO</span> <span class="nf">getUserInfo</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">userId</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 4</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"URL:"</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">()</span> <span class="o">+</span> <span class="s">" can access. userId:"</span> <span class="o">+</span> <span class="n">userId</span><span class="o">;</span> <span class="c1">// 5</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">UserVO</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ä¸Šè¿°ä»£ç ï¼Œæ ¹æ®æ³¨é‡Šçš„ä½ç½®æœ‰ä»¥ä¸‹è§£é‡Šï¼š</p>
<ol>
  <li>å£°æ˜æ˜¯ä¸€ä¸ªControllerï¼Œå¯ä»¥æ¥å—è¯·æ±‚</li>
  <li>å£°æ˜è¿”å›å€¼æ˜¯æ”¾åœ¨responseä½“ä¸­ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªé¡µé¢ã€‚å¯ä»¥å’Œæ³¨é‡Š1åˆç”¨ï¼Œç›´æ¥æŠŠæ³¨é‡Š1å†™æˆ<code class="language-plaintext highlighter-rouge">@RestController</code></li>
  <li>produceså¯ä»¥å®šåˆ¶è¿”å›æ•°æ®çš„responseåª’ä½“ç±»å‹å’Œå­—ç¬¦é›†ã€‚â€application/json;charset=UTF-8â€è¿”å›jsonæ ¼å¼ï¼Œâ€application/xml;charset=UTF-8â€è¿”å›xmlæ ¼å¼ã€‚è¿˜å¯ä»¥é€šè¿‡ç»§æ‰¿AbstractHttpMessageConverterçš„æ–¹å¼ï¼Œè‡ªå®šä¹‰åª’ä½“ç±»å‹ã€‚jsonå’Œxmlä¾èµ–çš„åŒ…å¦‚ä¸‹ï¼š</li>
</ol>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- jsonä¾èµ–çš„åŒ… --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.9.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- xmlä¾èµ–çš„åŒ… è¿™ä¸ªåŒ…å«äº†jsonçš„ä¾èµ–ï¼Œå› æ­¤å¦‚æœä¸æ”¯æŒxmlï¼Œå¯ä»¥åªç”¨ä¸Šé¢é‚£ä¸ªï¼›å¦‚æœè¦æ”¯æŒä¸¤ç§ï¼Œåªéœ€è¦è¿™ä¸ªå°±å¤Ÿäº†--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jackson-dataformat-xml<span class="nt">&lt;artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.9.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<ol>
  <li><code class="language-plaintext highlighter-rouge">@PathVariable</code>è¿™é‡Œçš„ç”¨æ³•æ˜¯ç”¨æ¥æ¥å—è·¯å¾„å‚æ•°ï¼Œå’Œæ³¨é‡Š3ä¸­çš„{userId}é…åˆä½¿ç”¨ã€‚</li>
  <li>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚æœè¯·æ±‚æ˜¯ï¼šhttp://localhost:8080/api/user/query/33.5ï¼Œåœ¨Spring MVCçš„é»˜è®¤é…ç½®ä¸‹ï¼ŒuserIdå‚æ•°åªèƒ½è·å–åˆ°33ï¼Œæ— æ³•è·å–åˆ°33.5ï¼›å‡å¦‚userIdæ˜¯Integerç±»å‹ï¼Œåˆ™æ­¤è¯·æ±‚é”™è¯¯ï¼›å‡å¦‚userIdæ˜¯Doubleç±»å‹ï¼Œåˆ™å¯ä»¥æ­£å¸¸è·å–33.5ã€‚è¦æƒ³è®©Stringç±»å‹çš„<code class="language-plaintext highlighter-rouge">@PathVariable</code>æ³¨è§£è·å–åˆ°æ­£ç¡®çš„æ•°æ®ï¼Œåˆ™åº”è¯¥é€šè¿‡åœ¨é…ç½®ä¸­é‡å†™configurePathMatchçš„æ–¹å¼æ¥å®ç°ï¼›Spring bootåˆ™æ²¡æœ‰è¿™ä¸ªé¡¾è™‘ï¼Œä¸é…ç½®ä¹Ÿèƒ½æ­£å¸¸è·å–åˆ°å¸¦â€œè‹±æ–‡å¥å·â€çš„å­—ç¬¦ä¸²å€¼ã€‚</li>
</ol>

<h3 id="controllerçš„å…¨å±€é…ç½®">Controllerçš„å…¨å±€é…ç½®</h3>
<p>é€šè¿‡<code class="language-plaintext highlighter-rouge">@ControllerAdvice</code>è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ§åˆ¶å™¨çš„å…¨å±€é…ç½®ï¼Œæ¯”å¦‚ç”¨<code class="language-plaintext highlighter-rouge">@ExceptionHandler</code>å¼‚å¸¸å¤„ç†ï¼›é€šè¿‡<code class="language-plaintext highlighter-rouge">@InitBinder</code>å®šåˆ¶WebDataBinderæ¥è¿‡æ»¤å‚æ•°ï¼›é€šè¿‡<code class="language-plaintext highlighter-rouge">@ModelAttribute</code>é…ç½®å…¨å±€çš„é”®å€¼å¯¹ã€‚</p>

<h3 id="æœåŠ¡å™¨ç«¯æ¨é€æŠ€æœ¯">æœåŠ¡å™¨ç«¯æ¨é€æŠ€æœ¯</h3>
<p>æ—©èµ·çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡Ajaxå‘æœåŠ¡å™¨è½®è®­ï¼Œä½†è½®è®­çš„é¢‘ç‡ä¸å¥½æ§åˆ¶ï¼Œå¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›ã€‚å¯è¡Œçš„æ–¹æ¡ˆæ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯æŠ“ä½è¿™ä¸ªè¯·æ±‚ä¸æ”¾ï¼Œç­‰æœ‰æ•°æ®æ›´æ–°çš„æ—¶å€™å†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯ï¼Œå†å‘æœåŠ¡å™¨ç«¯å‘è¯·æ±‚ï¼Œå‘¨è€Œå¤å§‹ï¼Œè¿™æ ·å°±è§£å†³äº†ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ã€‚è¿˜æœ‰ä¸€ç§åŒå‘é€šä¿¡æŠ€æœ¯ï¼Œç”¨<strong>WebSocket</strong>å®ç°ã€‚</p>

<h4 id="1-åŸºäºsseçš„æœåŠ¡å™¨ç«¯æ¨é€">1. åŸºäºSSEçš„æœåŠ¡å™¨ç«¯æ¨é€</h4>
<p>SSEï¼ˆServer Send Event æœåŠ¡ç«¯å‘é€äº‹ä»¶ï¼‰æŠ€æœ¯éœ€è¦æµè§ˆå™¨çš„æ”¯æŒï¼Œç›®å‰åªæœ‰æ–°å¼æµè§ˆå™¨æ”¯æŒï¼Œæ¯”å¦‚chromeå’Œfirefoxã€‚å®ç°æ—¶ï¼ŒæœåŠ¡ç«¯åœ¨Controllerå±‚ï¼Œå¯¹åº”çš„æ¥å£åª’ä½“ç±»å‹æ˜¯text/event-streamï¼›å®¢æˆ·ç«¯åœ¨å‰ç«¯ç•Œé¢ï¼Œéœ€è¦ç”¨åˆ°EventSourceå¯¹è±¡ï¼Œåœ¨å‰ç«¯ä»£ç ä¸­å®ç°ç›‘å¬æ¥è·å–æœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ã€‚</p>

<h4 id="2-servletå¼‚æ­¥æ–¹æ³•">2. Servlet+å¼‚æ­¥æ–¹æ³•</h4>
<ol>
  <li>å¼€å¯å¼‚æ­¥</li>
  <li>å®ç°ä¸€ä¸ªè¿”å›DeferredResultç±»å‹ç»“æœçš„æ¥å£</li>
  <li>ä¸Šè¿°æ¥å£ä»ä¸€ä¸ªService Beanä¸­è·å–ä¸€ä¸ªDeferredResultã€‚</li>
</ol>
:ET